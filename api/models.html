<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Defines the main models, tools, and base classes for simulating and implementing mathematical models of circadian rhythms.">

<title>Models – circadian by Arcascope</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-fd627b3a652ecd3c9d38f05f2f5694a5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Models – circadian by Arcascope">
<meta property="og:description" content="Defines the main models, tools, and base classes for simulating and implementing mathematical models of circadian rhythms.">
<meta property="og:image" content="https://arcascope.github.io/circadian//circadian/api/00_models_files/figure-html/cell-3-output-1.png">
<meta property="og:site_name" content="circadian by Arcascope">
<meta property="og:image:height" content="462">
<meta property="og:image:width" content="587">
<meta name="twitter:title" content="Models – circadian by Arcascope">
<meta name="twitter:description" content="Defines the main models, tools, and base classes for simulating and implementing mathematical models of circadian rhythms.">
<meta name="twitter:image" content="https://arcascope.github.io/circadian//circadian/api/00_models_files/figure-html/cell-3-output-1.png">
<meta name="twitter:image-height" content="462">
<meta name="twitter:image-width" content="587">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">circadian by Arcascope</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Arcascope/circadian"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/arcascope"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../api/models.html">API</a></li><li class="breadcrumb-item"><a href="../api/models.html">Models</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/effect_of_pulses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Circadian rhythm disruptions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/skeldon23_sleep_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Combining sleep and circadian models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/esri_calculation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ESRI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">API</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/lights.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lights</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/prc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PRC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metrics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/readers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/sleep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sleep</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/phasetools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phase Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/synthetic_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthetic Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#simulating-circadian-rhythms" id="toc-simulating-circadian-rhythms" class="nav-link" data-scroll-target="#simulating-circadian-rhythms">Simulating circadian rhythms</a>
  <ul class="collapse">
  <li><a href="#custom-parameters-and-initial-conditions" id="toc-custom-parameters-and-initial-conditions" class="nav-link" data-scroll-target="#custom-parameters-and-initial-conditions">Custom parameters and initial conditions</a></li>
  <li><a href="#simulating-from-multiple-initial-conditions" id="toc-simulating-from-multiple-initial-conditions" class="nav-link" data-scroll-target="#simulating-from-multiple-initial-conditions">Simulating from multiple initial conditions</a></li>
  <li><a href="#estimation-of-circadian-phase-markers" id="toc-estimation-of-circadian-phase-markers" class="nav-link" data-scroll-target="#estimation-of-circadian-phase-markers">Estimation of circadian phase markers</a></li>
  <li><a href="#amplitude-and-phase-calculation" id="toc-amplitude-and-phase-calculation" class="nav-link" data-scroll-target="#amplitude-and-phase-calculation">Amplitude and phase calculation</a></li>
  </ul></li>
  <li><a href="#implemented-models" id="toc-implemented-models" class="nav-link" data-scroll-target="#implemented-models">Implemented models</a>
  <ul class="collapse">
  <li><a href="#forger99" id="toc-forger99" class="nav-link" data-scroll-target="#forger99">Forger99</a></li>
  <li><a href="#jewett99" id="toc-jewett99" class="nav-link" data-scroll-target="#jewett99">Jewett99</a></li>
  <li><a href="#hannay19" id="toc-hannay19" class="nav-link" data-scroll-target="#hannay19">Hannay19</a></li>
  <li><a href="#hannay19tp" id="toc-hannay19tp" class="nav-link" data-scroll-target="#hannay19tp">Hannay19TP</a></li>
  <li><a href="#hilaire07" id="toc-hilaire07" class="nav-link" data-scroll-target="#hilaire07">Hilaire07</a></li>
  <li><a href="#skeldon23" id="toc-skeldon23" class="nav-link" data-scroll-target="#skeldon23">Skeldon23</a></li>
  </ul></li>
  <li><a href="#api-documentation" id="toc-api-documentation" class="nav-link" data-scroll-target="#api-documentation">API Documentation</a>
  <ul class="collapse">
  <li><a href="#dynamicaltrajectory" id="toc-dynamicaltrajectory" class="nav-link" data-scroll-target="#dynamicaltrajectory">DynamicalTrajectory</a></li>
  <li><a href="#dynamicaltrajectory.__call__" id="toc-dynamicaltrajectory.__call__" class="nav-link" data-scroll-target="#dynamicaltrajectory.__call__">DynamicalTrajectory.__call__</a></li>
  <li><a href="#dynamicaltrajectory.get_batch" id="toc-dynamicaltrajectory.get_batch" class="nav-link" data-scroll-target="#dynamicaltrajectory.get_batch">DynamicalTrajectory.get_batch</a></li>
  <li><a href="#circadianmodel" id="toc-circadianmodel" class="nav-link" data-scroll-target="#circadianmodel">CircadianModel</a></li>
  <li><a href="#circadianmodel.step_rk4" id="toc-circadianmodel.step_rk4" class="nav-link" data-scroll-target="#circadianmodel.step_rk4">CircadianModel.step_rk4</a></li>
  <li><a href="#circadianmodel.integrate" id="toc-circadianmodel.integrate" class="nav-link" data-scroll-target="#circadianmodel.integrate">CircadianModel.integrate</a></li>
  <li><a href="#circadianmodel.__call__" id="toc-circadianmodel.__call__" class="nav-link" data-scroll-target="#circadianmodel.__call__">CircadianModel.__call__</a></li>
  <li><a href="#circadianmodel.get_parameters_array" id="toc-circadianmodel.get_parameters_array" class="nav-link" data-scroll-target="#circadianmodel.get_parameters_array">CircadianModel.get_parameters_array</a></li>
  <li><a href="#circadianmodel.equilibrate" id="toc-circadianmodel.equilibrate" class="nav-link" data-scroll-target="#circadianmodel.equilibrate">CircadianModel.equilibrate</a></li>
  <li><a href="#circadianmodel.amplitude" id="toc-circadianmodel.amplitude" class="nav-link" data-scroll-target="#circadianmodel.amplitude">CircadianModel.amplitude</a></li>
  <li><a href="#circadianmodel.phase" id="toc-circadianmodel.phase" class="nav-link" data-scroll-target="#circadianmodel.phase">CircadianModel.phase</a></li>
  <li><a href="#circadianmodel.cbt" id="toc-circadianmodel.cbt" class="nav-link" data-scroll-target="#circadianmodel.cbt">CircadianModel.cbt</a></li>
  <li><a href="#circadianmodel.dlmos" id="toc-circadianmodel.dlmos" class="nav-link" data-scroll-target="#circadianmodel.dlmos">CircadianModel.dlmos</a></li>
  <li><a href="#forger99-1" id="toc-forger99-1" class="nav-link" data-scroll-target="#forger99-1">Forger99</a></li>
  <li><a href="#jewett99-1" id="toc-jewett99-1" class="nav-link" data-scroll-target="#jewett99-1">Jewett99</a></li>
  <li><a href="#hannay19-1" id="toc-hannay19-1" class="nav-link" data-scroll-target="#hannay19-1">Hannay19</a></li>
  <li><a href="#hannay19tp-1" id="toc-hannay19tp-1" class="nav-link" data-scroll-target="#hannay19tp-1">Hannay19TP</a></li>
  <li><a href="#hilaire07-1" id="toc-hilaire07-1" class="nav-link" data-scroll-target="#hilaire07-1">Hilaire07</a></li>
  <li><a href="#breslow13" id="toc-breslow13" class="nav-link" data-scroll-target="#breslow13">Breslow13</a></li>
  <li><a href="#skeldon23-1" id="toc-skeldon23-1" class="nav-link" data-scroll-target="#skeldon23-1">Skeldon23</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Arcascope/circadian/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../api/models.html">API</a></li><li class="breadcrumb-item"><a href="../api/models.html">Models</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Models</h1>
</div>

<div>
  <div class="description">
    Defines the main models, tools, and base classes for simulating and implementing mathematical models of circadian rhythms.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="overview" class="level1">
<h1>Overview</h1>
<p>The <code>circadian.models</code> module contains the essential tools for simulating circadian rhythms. The base class <a href="https://arcascope.github.io/circadian/api/models.html#dynamicaltrajectory"><code>DynamicalTrajectory</code></a> handles differential equation solutions, while the <a href="https://arcascope.github.io/circadian/api/models.html#circadianmodel"><code>CircadianModel</code></a> class handles the implementation of the models themselves. The first part of the documentation focuses on <a href="#simulating-circadian-rhythms">how to simulate circadian rhythms</a> while the second part <a href="#implemented-models">describes each model briefly</a>. For a description of each implementation see the <a href="#api-documentation">API Documentation</a>.</p>
</section>
<section id="simulating-circadian-rhythms" class="level1">
<h1>Simulating circadian rhythms</h1>
<p>To simulate a circadian model we need to provide a set of timepoints where we want to calculate the solution and a set of light inputs for each timepoint</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> circadian.models <span class="im">import</span> Forger99</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> circadian.lights <span class="im">import</span> LightSchedule</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time, <span class="bu">input</span><span class="op">=</span>light_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>we can plot the solution by acessing the trajectory’s <code>states</code></p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plt.plot(time<span class="op">/</span><span class="fl">24.0</span>, trajectory.states[:,<span class="dv">0</span>], label<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time (days)'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'State'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_models_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="custom-parameters-and-initial-conditions" class="level2">
<h2 class="anchored" data-anchor-id="custom-parameters-and-initial-conditions">Custom parameters and initial conditions</h2>
<p>In the example above, we are not defining initial conditions nor parameters. This is because each model in the library has a default set of parameters and initial conditions. Initial conditions and parameters used in the simulation can be accessed by</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model.initial_condition</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([-0.0843259 , -1.09607546,  0.45584306])</code></pre>
</div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'taux': 24.2,
 'mu': 0.23,
 'G': 33.75,
 'alpha_0': 0.05,
 'beta': 0.0075,
 'p': 0.5,
 'I0': 9500.0,
 'k': 0.55,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>We can run simulations with custom parameters and initial conditions by</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>custom_parameters <span class="op">=</span> {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'taux'</span>: <span class="fl">14.0</span>, <span class="st">'mu'</span>: <span class="fl">0.3</span>, <span class="st">'G'</span>: <span class="fl">34.0</span>, <span class="st">'alpha_0'</span>: <span class="fl">0.07</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'delta'</span>: <span class="fl">0.0095</span>, <span class="st">'p'</span>: <span class="fl">0.7</span>, <span class="st">'I0'</span>: <span class="fl">9300.0</span>, <span class="st">'kparam'</span>: <span class="fl">0.75</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cbt_to_dlmo'</span>: <span class="fl">7.0</span>}</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>custom_initial_condition <span class="op">=</span> np.array([<span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99(custom_parameters)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time, custom_initial_condition, light_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.plot(time<span class="op">/</span><span class="fl">24.0</span>, trajectory.states[:,<span class="dv">0</span>], label<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time (days)'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'State'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_models_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>When defining custom parameters we can specify only a subset and the rest will maintain their default values (or any previously defined values).</p>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99({<span class="st">'taux'</span>: <span class="fl">48.0</span>})</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time,  <span class="bu">input</span><span class="op">=</span>light_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_models_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simulating-from-multiple-initial-conditions" class="level2">
<h2 class="anchored" data-anchor-id="simulating-from-multiple-initial-conditions">Simulating from multiple initial conditions</h2>
<p>Models accept arrays of initial conditions allowing to simulate from multiple initial conditions at once. For example, to simulate the Forger99 model from 100 different initial conditions we can do</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>x_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="dv">10</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>xc_values <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="dv">10</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>x_xc_stack <span class="op">=</span> np.dstack(np.meshgrid(x_values, xc_values)).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>multiple_initial_conditions <span class="op">=</span> np.hstack((x_xc_stack, np.zeros((x_xc_stack.shape[<span class="dv">0</span>], <span class="dv">1</span>))))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>multiple_initial_conditions <span class="op">=</span> multiple_initial_conditions.T</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time, multiple_initial_conditions, light_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we have to format the initial conditions as a numpy array of dimensions (3, n) where n is the total number of initial conditions and 3 is the number of states in the model.</p>
<p>The resulting trajectory contains all the solutions in the same order as the initial conditions</p>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>trajectory.states.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(480, 3, 100)</code></pre>
</div>
</div>
<p>We can plot the solution for each initial condition by</p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(trajectory.states.shape[<span class="dv">2</span>]):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(time<span class="op">/</span><span class="fl">24.0</span>, trajectory.states[:,<span class="dv">0</span>,idx], </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="st">'b'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time (days)'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'State'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_models_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is the recommended method to simulate multiple initial conditions–by passing a numpy array to the model. Our implementation takes advantage of numpy’s vectorization to speed up the calculation. If we simulate each initial condition individually, the simulation will be slower.</p>
</section>
<section id="estimation-of-circadian-phase-markers" class="level2">
<h2 class="anchored" data-anchor-id="estimation-of-circadian-phase-markers">Estimation of circadian phase markers</h2>
<p>Models support the estimation of Dim Light Melatonin Onset (DLMO) and Core Body Temperature Minimum (CBTmin) directly from the solution</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time, <span class="bu">input</span><span class="op">=</span>light_input)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>cbt_times <span class="op">=</span> model.cbt()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>dlmo_times <span class="op">=</span> model.dlmos()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-32" class="cell">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_models_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="amplitude-and-phase-calculation" class="level2">
<h2 class="anchored" data-anchor-id="amplitude-and-phase-calculation">Amplitude and phase calculation</h2>
<p>Models also support the calculation of amplitude and phase at any desired timepoint</p>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>simulation_days <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># hours</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">24</span> <span class="op">*</span> simulation_days, dt)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>light_schedule <span class="op">=</span> LightSchedule.Regular()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>light_input <span class="op">=</span> light_schedule(time)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>trajectory <span class="op">=</span> model(time, <span class="bu">input</span><span class="op">=</span>light_input)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>t_final <span class="op">=</span> time[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>final_phase <span class="op">=</span> model.phase(time<span class="op">=</span>t_final)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>final_amplitude <span class="op">=</span> model.amplitude(time<span class="op">=</span>t_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Final phase: 1.8767451135044504
Final amplitude: 1.0730477511869494</code></pre>
</div>
</div>
</section>
</section>
<section id="implemented-models" class="level1">
<h1>Implemented models</h1>
<section id="forger99" class="level2">
<h2 class="anchored" data-anchor-id="forger99">Forger99</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#forger99"><code>Forger99</code></a> model is taken from <a href="https://doi.org/10.1177/074873099129000867">Forger, Jewett, and Kronauer’s 1999 article</a> which defines a simplification of previous iterations of the van der Pol based oscillator models published in the 1990s. It is one of the most popular models in the circadian literature. The implementation in this package uses the parameters taken from <a href="https://doi.org/10.1371/journal.pcbi.1003523">Serkh and Forger 2014</a> rather than the parameters from the original paper.</p>
<p>The model states are defined by three dynamic variables: <span class="math inline">\(x\)</span>, <span class="math inline">\(x_c\)</span>, and <span class="math inline">\(n\)</span>. These states are related to circadian rhythms by defining the core body temperature minimum (a biomarker for circadian state) to be the minimum of the <span class="math inline">\(x\)</span> variable.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#forger99"><code>Forger99</code></a> model are:</p>
<p><span class="math inline">\(\frac{dx}{dt} = \frac{\pi}{12}(x_c + B)\)</span></p>
<p><span class="math inline">\(\frac{dx_c}{dt} = \frac{\pi}{12}\left\{\mu \left( x_c - \frac{4x_{c}^3}{3} \right) - x \left[ \left( \frac{24}{0.99669 \tau_x} \right)^2 + kB \right] \right\}\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60[\alpha(I)(1-n)-\beta n]\)</span></p>
<p>where</p>
<p><span class="math inline">\(\alpha(I) = \alpha_0\left( \frac{I^p}{I_0^p}\right)\)</span></p>
<p><span class="math inline">\(B = G(1-n)\alpha(I)(1-0.4x)(1-0.4x_c)\)</span></p>
<p>The default parameters for this model are:</p>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Forger99()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'taux': 24.2,
 'mu': 0.23,
 'G': 33.75,
 'alpha_0': 0.05,
 'beta': 0.0075,
 'p': 0.5,
 'I0': 9500.0,
 'k': 0.55,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> parameter is used to convert the core body temperature minimum to DLMO. The default behavior is DLMO ocurring 7 hours before CBTmin.</p>
</section>
<section id="jewett99" class="level2">
<h2 class="anchored" data-anchor-id="jewett99">Jewett99</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#jewett99"><code>Jewett99</code></a> model is taken from <a href="https://doi.org/10.1177/074873049901400608">Jewett, Forger, and Kronauer’s 1999 article</a> which defines several refinements to a van der Pol oscillator model developed by Kronauer previously. One of the main features of this model are the high-order terms in the differential equations which allow for a more accurate representation of the circadian system than previous models.</p>
<p>Similarly to <a href="https://arcascope.github.io/circadian/api/models.html#forger99"><code>Forger99</code></a> the model states are defined by three dynamic variables: <span class="math inline">\(x\)</span>, <span class="math inline">\(x_c\)</span>, and <span class="math inline">\(n\)</span>. The variable <span class="math inline">\(x\)</span> is related to the core body temperature and <span class="math inline">\(n\)</span> to the processed light input.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#jewett99"><code>Jewett99</code></a> model are:</p>
<p><span class="math inline">\(\frac{dx}{dt} = \frac{\pi}{12} \left[x_c + \mu \left(\frac{x}{3} + \frac{4x^3}{3} - \frac{256 x^7}{105}\right) + B\right]\)</span></p>
<p><span class="math inline">\(\frac{dx_c}{dt} = \frac{\pi}{12} \left\{ q B x_c - \left[ \left( \frac{24}{0.99729 \tau_{x}} \right)^2 + k B \right] x \right\}\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60[\alpha(I)(1-n)-\beta n]\)</span></p>
<p>where</p>
<p><span class="math inline">\(\alpha(I) = \alpha_0\left( \frac{I^p}{I_0^p}\right)\)</span></p>
<p><span class="math inline">\(B = G(1-n)\alpha(I)(1-0.4x)(1-0.4x_c)\)</span></p>
<p>The default parameters for this model are:</p>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Jewett99()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'taux': 24.2,
 'mu': 0.13,
 'G': 19.875,
 'beta': 0.013,
 'k': 0.55,
 'q': 0.3333333333333333,
 'I0': 9500,
 'p': 0.6,
 'alpha_0': 0.16,
 'phi_ref': 0.8,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> and <code>phi_ref</code> parameters are used to calculate the core body temperature minimum and convert it to DLMO. The CBTmin is calculated as the minimum of the <span class="math inline">\(x\)</span> variable plus a shift of <span class="math inline">\(\phi_{\text{ref}}=0.8\)</span> hours. The DLMO is calculated as CBTmin minus 7.0 hours.</p>
</section>
<section id="hannay19" class="level2">
<h2 class="anchored" data-anchor-id="hannay19">Hannay19</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#hannay19"><code>Hannay19</code></a> model is taken from <a href="https://doi.org/10.1177/0748730419878298">Hannay, Booth, and Forger’s 2019 article</a>. This model isn’t based on a van der Pol oscillator and instead it is systematically derived from a high-dimensional model for each clock neuron using the <span class="math inline">\(m^2\)</span> ansatz (<a href="https://doi.org/10.1126/sciadv.1701047">Hannay et al.&nbsp;2018</a>). The <a href="https://arcascope.github.io/circadian/api/models.html#hannay19"><code>Hannay19</code></a> implementation corresponds to the single population model within the article.</p>
<p>The model describes the circadian state using polar coordinates and features a slight modification fo the light processing function found in van der Pol type models. Thus, the model states are defined by: <span class="math inline">\(R\)</span>, <span class="math inline">\(\psi\)</span>, and <span class="math inline">\(n\)</span>.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#hannay19"><code>Hannay19</code></a> model are:</p>
<p><span class="math inline">\(\frac{dR}{dt} = - (D + \gamma)R + \frac{K}{2}cos(\beta)R(1-R^4) + L_R(R, \psi)\)</span></p>
<p><span class="math inline">\(\frac{d\psi}{dt} = \omega_0 + \frac{K}{2}sin(\beta)(1+R^4) + L_{\psi}(R,\psi)\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60\left[\alpha(I)(1-n)-\delta n \right]\)</span></p>
<p>where</p>
<p><span class="math inline">\(L_R(R,\psi) = \frac{A_1}{2}B(t)(1-R^4)cos(\psi + \beta_{L1}) + \frac{A_2}{2}B(t)R(1-R^8)cos(2\psi + \beta_{L2})\)</span></p>
<p><span class="math inline">\(L_{\psi}(R, \psi) = \sigma B(t) - \frac{A_1}{2}B(t)\left(\frac{1}{R} + R^3 \right)\sin(\psi + \beta_{L1}) - \frac{A_2}{2}B(t)(1+R^8)\sin(2\psi + \beta_{L2})\)</span></p>
<p><span class="math inline">\(\alpha(I) = \frac{\alpha_0 I^p}{I^p + I_0}\)</span></p>
<p><span class="math inline">\(B(t) = G(1-n)\alpha(L)\)</span></p>
<p>The default parameters for this model are:</p>
<div id="cell-76" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Hannay19()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'tau': 23.84,
 'K': 0.06358,
 'gamma': 0.024,
 'Beta1': -0.09318,
 'A1': 0.3855,
 'A2': 0.1977,
 'BetaL1': -0.0026,
 'BetaL2': -0.957756,
 'sigma': 0.0400692,
 'G': 33.75,
 'alpha_0': 0.05,
 'delta': 0.0075,
 'p': 1.5,
 'I0': 9325.0,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> parameter is used to convert the core body temperature minimum to DLMO. The default behavior is DLMO ocurring 7 hours before CBTmin.</p>
</section>
<section id="hannay19tp" class="level2">
<h2 class="anchored" data-anchor-id="hannay19tp">Hannay19TP</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#hannay19tp"><code>Hannay19TP</code></a> model comes from the same article as <a href="https://arcascope.github.io/circadian/api/models.html#hannay19"><code>Hannay19</code></a> but stems from two populations of clock neurons rather than one. These two populations are the dorsal and ventral ones which define the model states to be: <span class="math inline">\(R_v\)</span>, <span class="math inline">\(R_d\)</span>, <span class="math inline">\(\psi_v\)</span>, <span class="math inline">\(\psi_d\)</span>, and <span class="math inline">\(n\)</span>.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#hannay19tp"><code>Hannay19TP</code></a> model are:</p>
<p><span class="math inline">\(\frac{dR_v}{dt} = -\gamma R_v + \frac{K_{vv}}{2} R_v (1 - R_{v}^4) + \frac{K_{dv}}{2}R_d (1 - R_{v}^4)\cos(\psi_d - \psi_v) + L_R(R_v, \psi_v)\)</span></p>
<p><span class="math inline">\(\frac{dR_d}{dt} = -\gamma R_d + \frac{K_{dd}}{2} R_d (1 - R_{d}^4) + \frac{K_{vd}}{2} R_v (1 - R_{d}^4)\cos(\psi_d - \psi_v)\)</span></p>
<p><span class="math inline">\(\frac{d\psi_v}{dt} = \omega_v + \frac{K_{dv}}{2} R_d \left( \frac{1}{R_v} + R_{v}^3\right)\sin(\psi_d - \psi_v) + L_\psi(R_v, \psi_v)\)</span></p>
<p><span class="math inline">\(\frac{d\psi_d}{dt} = \omega_d - \frac{K_{vd}}{2} R_v \left( \frac{1}{R_d} + R_{d}^3\right)\sin(\psi_d - \psi_v)\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60\left[\alpha(I)(1-n)-\delta n \right]\)</span></p>
<p>where</p>
<p><span class="math inline">\(L_R(R_v,\psi_v) = \frac{A_1}{2}B(t)(1-R_v^4)cos(\psi_v + \beta_{L1}) + \frac{A_2}{2}B(t)R_v(1-R_v^8)cos(2\psi_v + \beta_{L2})\)</span></p>
<p><span class="math inline">\(L_{\psi}(R_v, \psi_v) = \sigma B(t) - \frac{A_1}{2}B(t)\left(\frac{1}{R_v} + R_v^3 \right)\sin(\psi_v + \beta_{L1}) - \frac{A_2}{2}B(t)(1+R_v^8)\sin(2\psi_v + \beta_{L2})\)</span></p>
<p><span class="math inline">\(\alpha(I) = \frac{\alpha_0 I^p}{I^p + I_0}\)</span></p>
<p><span class="math inline">\(B(t) = G(1-n)\alpha(L)\)</span></p>
<p>The default parameters for this model are:</p>
<div id="cell-92" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Hannay19TP()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'tauV': 24.25,
 'tauD': 24.0,
 'Kvv': 0.05,
 'Kdd': 0.04,
 'Kvd': 0.05,
 'Kdv': 0.01,
 'gamma': 0.024,
 'A1': 0.440068,
 'A2': 0.159136,
 'BetaL': 0.06452,
 'BetaL2': -1.38935,
 'sigma': 0.0477375,
 'G': 33.75,
 'alpha_0': 0.05,
 'delta': 0.0075,
 'p': 1.5,
 'I0': 9325.0,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> parameter is used to convert the core body temperature minimum to DLMO. The default behavior is DLMO ocurring 7 hours before CBTmin.</p>
</section>
<section id="hilaire07" class="level2">
<h2 class="anchored" data-anchor-id="hilaire07">Hilaire07</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#hilaire07"><code>Hilaire07</code></a> model is taken from <a href="https://doi.org/10.1016/j.jtbi.2007.04.001">Hilaire et al.&nbsp;2007</a> which extends the <a href="https://arcascope.github.io/circadian/api/models.html#jewett99"><code>Jewett99</code></a> model to include a non-photic input. The model states are defined by three dynamic variables: <span class="math inline">\(x\)</span>, <span class="math inline">\(x_c\)</span>, and <span class="math inline">\(n\)</span> whereas the inputs are light and sleep/wake state. The variable <span class="math inline">\(x\)</span> is related to the core body temperature and <span class="math inline">\(n\)</span> to the processed light input.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#hilaire07"><code>Hilaire07</code></a> model are:</p>
<p><span class="math inline">\(\frac{dx}{dt} = \frac{\pi}{12} \left[x_c + \mu \left(\frac{x}{3} + \frac{4x^3}{3} - \frac{256 x^7}{105}\right) + B + N_{s}\right]\)</span></p>
<p><span class="math inline">\(\frac{dx_c}{dt} = \frac{\pi}{12} \left\{ q B x_c - \left[ \left( \frac{24}{0.99729 \tau_{x}} \right)^2 + k B \right] x \right\}\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60[\alpha(I)(1-n)-\beta n]\)</span></p>
<p>where</p>
<p><span class="math inline">\(\alpha(I) = \alpha_0\left( \frac{I^p}{I_0^p}\right) \left( \frac{I}{I + 100} \right)\)</span></p>
<p><span class="math inline">\(B = G(1-n)\alpha(I)(1-0.4x)(1-0.4x_c)\)</span></p>
<p><span class="math inline">\(N_{s} = \hat{N}_{s} \left[1 - \tanh(10x) \right]\)</span></p>
<p><span class="math inline">\(\hat{N}_{s} = \left\{\begin{matrix}
\frac{\rho}{3} &amp; \text{if} \ \ \ \psi_{cx} \in (16.5, 21.0) \\
(\frac{1}{3} - \sigma) \rho &amp; \text{otherwise}
\end{matrix}\right.\)</span></p>
<p><span class="math inline">\(\psi_{cx} = \left[ (t \mod 24) - 24\frac{\phi_{xcx} + \phi_{ref}}{2\pi} \right]\mod 24\)</span></p>
<p><span class="math inline">\(\sigma = \left\{\begin{matrix}
1 &amp; \text{if asleep} \\
0 &amp; \text{if awake}
\end{matrix}\right.\)</span></p>
<p>Note that both <span class="math inline">\(I\)</span> and <span class="math inline">\(\sigma\)</span> are inputs to the model</p>
<p>The default parameters for this model are:</p>
<div id="cell-109" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Hilaire07()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'taux': 24.2,
 'G': 37.0,
 'k': 0.55,
 'mu': 0.13,
 'beta': 0.007,
 'q': 0.3333333333333333,
 'rho': 0.032,
 'I0': 9500.0,
 'p': 0.5,
 'a0': 0.1,
 'phi_xcx': -2.98,
 'phi_ref': 0.97,
 'cbt_to_dlmo': 7.0}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> and <code>phi_ref</code> parameters are used to calculate the core body temperature minimum and convert it to DLMO. The CBTmin is calculated as the minimum of the <span class="math inline">\(x\)</span> variable plus a shift of <span class="math inline">\(\phi_{\text{ref}}=0.97\)</span> hours. The DLMO is calculated as CBTmin minus 7.0 hours.</p>
</section>
<section id="skeldon23" class="level2">
<h2 class="anchored" data-anchor-id="skeldon23">Skeldon23</h2>
<p>The <a href="https://arcascope.github.io/circadian/api/models.html#skeldon23"><code>Skeldon23</code></a> model is based on <a href="https://doi.org/10.1101/2023.06.14.544757">Skeldon et al.&nbsp;2023</a> which combines a sleep pressure model with <a href="https://arcascope.github.io/circadian/api/models.html#forger99"><code>Forger99</code></a> to estimate realistic sleep/wake patterns. The model states are defined by four dynamic variables: <span class="math inline">\(x\)</span>, <span class="math inline">\(x_c\)</span>, <span class="math inline">\(n\)</span>, and <span class="math inline">\(H\)</span>. The variable <span class="math inline">\(x\)</span> is related to the core body temperature, <span class="math inline">\(n\)</span> to the processed light input, and <span class="math inline">\(H\)</span> to the sleep pressure signal. Note that in our implementation we have favored <a href="https://arcascope.github.io/circadian/api/models.html#forger99"><code>Forger99</code></a>’s notation of variables. In the original article, Skeldon et al.&nbsp;use variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> to indicate <span class="math inline">\(x_c\)</span> and <span class="math inline">\(x\)</span> respectively. Additionally, in this implementation, we have rescaled parameters to be defined in terms of hours rather than seconds. In addition to providing the states over time, the model also predicts sleep/wake patterns for each timepoint.</p>
<p>The differential equations governing the evolution of the <a href="https://arcascope.github.io/circadian/api/models.html#skeldon23"><code>Skeldon23</code></a> model are:</p>
<p><span class="math inline">\(\frac{dx}{dt} = \frac{1}{\kappa} \left(x_c + B \right)\)</span></p>
<p><span class="math inline">\(\frac{dx_c}{dt} = \frac{1}{\kappa}\left\{\gamma \left( x_c - \frac{4x_{c}^3}{3} \right) - x \left[ \left( \frac{24}{f \tau_x} \right)^2 + kB \right] \right\}\)</span></p>
<p><span class="math inline">\(\frac{dn}{dt} = 60[\alpha(\tilde{I})(1-n)-\beta n]\)</span></p>
<p>$ = $</p>
<p>where</p>
<p><span class="math inline">\(S = \left\{\begin{matrix}
1 &amp; \text{if asleep} \\
0 &amp; \text{if awake}
\end{matrix}\right.\)</span></p>
<p><span class="math inline">\(\tilde{I} = (1 - S) I\)</span></p>
<p><span class="math inline">\(\alpha(\tilde{I}) = \alpha_0\left( \frac{\tilde{I}}{I_0}\right)^p\)</span></p>
<p><span class="math inline">\(B = G(1-n)\alpha(\tilde{I})(1-bx)(1-bx_c)\)</span></p>
<p>the variable <span class="math inline">\(S\)</span> switches automatically based on the sleep pressure signal <span class="math inline">\(H\)</span> and the circadian input to the sleep model <span class="math inline">\(C\)</span>:</p>
<p><span class="math inline">\(C(t) = c_{20} + \alpha_{21}x_{c} + \alpha_{22}x + \beta_{21}x_{c}^2 + \beta_{22}x_{c}x + \beta_{23}x^2\)</span></p>
<p>The change from wake to sleep occurs when <span class="math inline">\(H\)</span> reaches</p>
<p><span class="math inline">\(H^{+}(t) = \overline{H}_{0} + \frac{\Delta}{2} + c_{a} C(t)\)</span></p>
<p>and the change from sleep to wake occurs when <span class="math inline">\(H\)</span> reaches</p>
<p><span class="math inline">\(H^{-}(t) = \overline{H}_{0} - \frac{\Delta}{2} + c_{a} C(t)\)</span></p>
<p>The default parameters for this model are:</p>
<div id="cell-130" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Skeldon23()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model.parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'mu': 17.78,
 'chi': 45.0,
 'H0': 13.0,
 'Delta': 1.0,
 'ca': 1.72,
 'tauc': 24.2,
 'f': 0.99669,
 'G': 19.9,
 'p': 0.6,
 'k': 0.55,
 'b': 0.4,
 'gamma': 0.23,
 'alpha_0': 0.16,
 'beta': 0.013,
 'I0': 9500.0,
 'kappa': 3.819718634205488,
 'c20': 0.7896,
 'alpha21': -0.3912,
 'alpha22': 0.7583,
 'beta21': -0.4442,
 'beta22': 0.025,
 'beta23': -0.9647,
 'S0': 0.0,
 'cbt_to_dlmo': 7.0,
 'forced_wakeup_light_threshold': None}</code></pre>
</div>
</div>
<p>The <code>cbt_to_dlmo</code> parameter is used to convert the core body temperature minimum to DLMO. The default behavior is DLMO ocurring 7 hours before CBTmin.</p>
</section>
</section>
<section id="api-documentation" class="level1">
<h1>API Documentation</h1>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L46" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dynamicaltrajectory" class="level3">
<h3 class="anchored" data-anchor-id="dynamicaltrajectory">DynamicalTrajectory</h3>
<blockquote class="blockquote">
<pre><code> DynamicalTrajectory (time:numpy.ndarray, states:numpy.ndarray)</code></pre>
</blockquote>
<p><em>A class to store solutions of differential equation models that contains both the time points and the states</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>ndarray</td>
<td>time points</td>
</tr>
<tr class="even">
<td>states</td>
<td>ndarray</td>
<td>state at time points</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L66" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dynamicaltrajectory.__call__" class="level3">
<h3 class="anchored" data-anchor-id="dynamicaltrajectory.__call__">DynamicalTrajectory.__call__</h3>
<blockquote class="blockquote">
<pre><code> DynamicalTrajectory.__call__ (timepoint:float)</code></pre>
</blockquote>
<p><em>Return the state at time t, linearly interpolated</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>timepoint</td>
<td>float</td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>ndarray</strong></td>
<td><strong>state of the system</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L105" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dynamicaltrajectory.get_batch" class="level3">
<h3 class="anchored" data-anchor-id="dynamicaltrajectory.get_batch">DynamicalTrajectory.get_batch</h3>
<blockquote class="blockquote">
<pre><code> DynamicalTrajectory.get_batch (batch_idx:int)</code></pre>
</blockquote>
<p><em>Obtain the trajectory for a single batch</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L210" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel">CircadianModel</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel (default_params:dict, num_states:int, num_inputs:int,
                 default_initial_condition:numpy.ndarray)</code></pre>
</blockquote>
<p><em>Abstract base class for circadian models that defines the common interface for all implementations</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>default_params</td>
<td>dict</td>
<td>default parameters for the model</td>
</tr>
<tr class="even">
<td>num_states</td>
<td>int</td>
<td>number of independent variables in the model</td>
</tr>
<tr class="odd">
<td>num_inputs</td>
<td>int</td>
<td>number of inputs to the model such as light or wake state</td>
</tr>
<tr class="even">
<td>default_initial_condition</td>
<td>ndarray</td>
<td>default initial conditions for the model</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>None</strong></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L306" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.step_rk4" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.step_rk4">CircadianModel.step_rk4</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.step_rk4 (t:float, state:numpy.ndarray,
                          input:numpy.ndarray, dt:float)</code></pre>
</blockquote>
<p><em>Integrate the state of the model for one timestep using a fourth-order Runge-Kutta algorithm. Assumes a constant light value for the time step</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>t</td>
<td>float</td>
<td>time</td>
</tr>
<tr class="even">
<td>state</td>
<td>ndarray</td>
<td>dynamical state of the model</td>
</tr>
<tr class="odd">
<td>input</td>
<td>ndarray</td>
<td>inputs to the model such as light or wake state</td>
</tr>
<tr class="even">
<td>dt</td>
<td>float</td>
<td>step size in hours</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>ndarray</strong></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L322" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.integrate" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.integrate">CircadianModel.integrate</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.integrate (time:numpy.ndarray,
                           initial_condition:numpy.ndarray=None,
                           input:numpy.ndarray=None)</code></pre>
</blockquote>
<p><em>Solve the model for specific timepoints given initial conditions and model inputs</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>ndarray</td>
<td></td>
<td>time points for integration. Time difference between consecutive values determines step size of the solver</td>
</tr>
<tr class="even">
<td>initial_condition</td>
<td>ndarray</td>
<td>None</td>
<td>initial state of the model</td>
</tr>
<tr class="odd">
<td>input</td>
<td>ndarray</td>
<td>None</td>
<td>model input (such as light or wake) for each time point</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>DynamicalTrajectory</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L358" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.__call__" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.__call__">CircadianModel.__call__</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.__call__ (time:numpy.ndarray,
                          initial_condition:numpy.ndarray=None,
                          input:numpy.ndarray=None)</code></pre>
</blockquote>
<p><em>Wrapper to integrate</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>ndarray</td>
<td></td>
<td>time points for integration. Time difference between each consecutive pair of values determines step size of the solver</td>
</tr>
<tr class="even">
<td>initial_condition</td>
<td>ndarray</td>
<td>None</td>
<td>initial state of the model</td>
</tr>
<tr class="odd">
<td>input</td>
<td>ndarray</td>
<td>None</td>
<td>model input (such as light or wake) for each time point</td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L368" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.get_parameters_array" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.get_parameters_array">CircadianModel.get_parameters_array</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.get_parameters_array ()</code></pre>
</blockquote>
<p><em>Returns the parameters for the model as a numpy array</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L411" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.equilibrate" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.equilibrate">CircadianModel.equilibrate</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.equilibrate (time:numpy.ndarray, input:numpy.ndarray,
                             num_loops:int=10)</code></pre>
</blockquote>
<p><em>Equilibrate the model by looping the given light_estimate. Assumes the schedule repeats periodically after it ends</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>time</td>
<td>ndarray</td>
<td></td>
<td>time points for integration. Time difference between each consecutive pair of values determines step size of the solver</td>
</tr>
<tr class="even">
<td>input</td>
<td>ndarray</td>
<td></td>
<td>model input (such as light or wake) for each time point</td>
</tr>
<tr class="odd">
<td>num_loops</td>
<td>int</td>
<td>10</td>
<td>number of times to loop the input</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>ndarray</strong></td>
<td></td>
<td><strong>final state of the model</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L386" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.amplitude" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.amplitude">CircadianModel.amplitude</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.amplitude (trajectory:__main__.DynamicalTrajectory=None,
                           time:float=None)</code></pre>
</blockquote>
<p><em>Calculates the amplitude of the model at a given timepoint</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>trajectory</td>
<td>DynamicalTrajectory</td>
<td>None</td>
<td>trajectory to calculate the amplitude for. If None, the amplitude is calculated for the current trajectory</td>
</tr>
<tr class="even">
<td>time</td>
<td>float</td>
<td>None</td>
<td>timepoint to calculate the amplitude at. If None, the amplitude is calculated for the entire trajectory</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>float</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L377" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.phase" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.phase">CircadianModel.phase</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.phase (trajectory:__main__.DynamicalTrajectory=None,
                       time:float=None)</code></pre>
</blockquote>
<p><em>Calculates the phase of the model at a given timepoint</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>trajectory</td>
<td>DynamicalTrajectory</td>
<td>None</td>
<td>trajectory to calculate the phase for. If None, the phase is calculated for the current trajectory</td>
</tr>
<tr class="even">
<td>time</td>
<td>float</td>
<td>None</td>
<td>timepoint to calculate the phase at. If None, the phase is calculated for the entire trajectory</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>float</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L395" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.cbt" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.cbt">CircadianModel.cbt</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.cbt (trajectory:__main__.DynamicalTrajectory=None)</code></pre>
</blockquote>
<p><em>Finds the core body temperature minumum markers along a trajectory</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>trajectory</td>
<td>DynamicalTrajectory</td>
<td>None</td>
<td>trajectory to calculate the cbt for. If None, the cbt is calculated for the current trajectory</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>ndarray</strong></td>
<td></td>
<td><strong>array of times when the cbt occurs</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L403" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circadianmodel.dlmos" class="level3">
<h3 class="anchored" data-anchor-id="circadianmodel.dlmos">CircadianModel.dlmos</h3>
<blockquote class="blockquote">
<pre><code> CircadianModel.dlmos (trajectory:__main__.DynamicalTrajectory=None)</code></pre>
</blockquote>
<p><em>Finds the Dim Light Melatonin Onset (DLMO) markers along a trajectory</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>trajectory</td>
<td>DynamicalTrajectory</td>
<td>None</td>
<td>trajectory to calculate the dlmos for. If None, the dlmos are calculated for the current trajectory</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>ndarray</strong></td>
<td></td>
<td><strong>array of times when dlmo occurs</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#LNone" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="forger99-1" class="level3">
<h3 class="anchored" data-anchor-id="forger99-1">Forger99</h3>
<blockquote class="blockquote">
<pre><code> Forger99 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Forger’s 1999 model from the article ‘A simpler model of the human circadian pacemaker’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#LNone" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="jewett99-1" class="level3">
<h3 class="anchored" data-anchor-id="jewett99-1">Jewett99</h3>
<blockquote class="blockquote">
<pre><code> Jewett99 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Jewett’s 1999 model from the article ‘Revised Limit Cycle Oscillator Model of Human Circadian Pacemaker’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#LNone" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hannay19-1" class="level3">
<h3 class="anchored" data-anchor-id="hannay19-1">Hannay19</h3>
<blockquote class="blockquote">
<pre><code> Hannay19 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Hannay’s 2019 single population model from the article ‘Macroscopic models for human circadian rhythms’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#LNone" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hannay19tp-1" class="level3">
<h3 class="anchored" data-anchor-id="hannay19tp-1">Hannay19TP</h3>
<blockquote class="blockquote">
<pre><code> Hannay19TP (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Hannay’s 2019 two population model from the article ‘Macroscopic models for human circadian rhythms’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L1026" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hilaire07-1" class="level3">
<h3 class="anchored" data-anchor-id="hilaire07-1">Hilaire07</h3>
<blockquote class="blockquote">
<pre><code> Hilaire07 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Hilaire’s 2007 model from the article ‘Addition of a non-photic component to a light-based mathematical model of the human circadian pacemaker’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L1177" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="breslow13" class="level3">
<h3 class="anchored" data-anchor-id="breslow13">Breslow13</h3>
<blockquote class="blockquote">
<pre><code> Breslow13 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of melatonin suppression model from Breslow’s 2013 article ‘A Mathematical Model of the Circadian Phase-Shifting Effects of Exogenous Melatonin’</em></p>
<hr>
<p><a href="https://github.com/Arcascope/circadian/blob/main/circadian/models.py#L1349" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="skeldon23-1" class="level3">
<h3 class="anchored" data-anchor-id="skeldon23-1">Skeldon23</h3>
<blockquote class="blockquote">
<pre><code> Skeldon23 (params=None)</code></pre>
</blockquote>
<p><em>Implementation of Skeldon’s 2023 model from the article ‘Method to determine whether sleep phenotypes are driven by endogenous circadian rhythms or environmental light by combining longitudinal data and personalised mathematical models’</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/arcascope\.github\.io\/circadian\/\/circadian");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Arcascope/circadian/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>